generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@map("categories")
}

model Service {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  longDescription String? @db.Text
  icon        String?
  image       String?
  price       Float
  pricingType String   @default("from") // "from", "fixed", "quote"
  duration    String?
  featured    Boolean  @default(false)
  active      Boolean  @default(true)
  features    String[] @default([])
  category    String?
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([active])
  @@index([featured])
  @@index([category])
  @@map("services")
}

model Product {
  id                      String                @id @default(cuid())
  name                    String
  slug                    String                @unique
  description             String?
  brand                   String?
  categoryId              String
  price                   Float
  originalPrice           Float?
  sku                     String                @unique
  stock                   Int
  rating                  Float                 @default(0)
  reviewCount             Int                   @default(0)
  inStock                 Boolean               @default(true)
  image                   String?
  specs                   Json                  @default("{}")
  featured                Boolean               @default(false)
  onSale                  Boolean               @default(false)
  limitedTimeOffer        Boolean               @default(false)
  offerEndsAt             DateTime?
  active                  Boolean               @default(true)
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  images                  String[]              @default([])
  inventoryLogs           InventoryLog[]
  orderItems              OrderItem[]
  variants                ProductVariant[]
  category                Category              @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  reviews                 Review[]
  stockAlerts             StockAlert[]
  wishlistItems           WishlistItem[]
  productSuppliers        ProductSupplier[]
  salesVelocity           SalesVelocity?
  stockRecommendation     StockRecommendation?
  reorderTasks            ReorderTask[]
  deadStockAlert          DeadStockAlert?
  productUnits            ProductUnit[]
  saleItems               SaleItem[]

  @@index([categoryId])
  @@index([active])
  @@index([categoryId, active])
  @@index([featured, active])
  @@index([price, active])
  @@index([createdAt])
  @@map("products")
}

model ProductVariant {
  id            String         @id @default(cuid())
  productId     String
  sku           String         @unique
  name          String
  color         String?
  size          String?
  storage       String?
  price         Float
  originalPrice Float?
  stock         Int            @default(0)
  inStock       Boolean        @default(true)
  image         String?
  sortOrder     Int            @default(0)
  active        Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  orderItems    OrderItem[]
  product       Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockAlerts   StockAlert[]
  wishlistItems WishlistItem[]

  @@index([productId])
  @@index([active])
  @@map("product_variants")
}

model User {
  id               String          @id @default(cuid())
  name             String?
  email            String          @unique
  emailVerified    DateTime?
  password         String?
  image            String?
  role             String          @default("user")
  phone            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  twoFactorEnabled Boolean         @default(false)
  twoFactorSecret  String?
  accounts         Account[]
  addresses        Address[]
  orders           Order[]
  reviews          Review[]
  sessions         Session[]
  stockAlerts      StockAlert[]
  supportTickets   SupportTicket[]
  ticketMessages   TicketMessage[]
  wishlistItems    WishlistItem[]
  searchHistory    OrderSearchHistory[]
  auditLogs        AuditLog[]
  savedFilters     SavedFilter[]
  salesCreated     Sale[]          @relation("SalesCreatedBy")
  salesAsCustomer  Sale[]          @relation("SalesCustomer")

  @@map("users")
}

model Address {
  id           String   @id @default(cuid())
  userId       String
  label        String
  fullName     String
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  postalCode   String
  country      String   @default("US")
  phone        String
  isDefault    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("addresses")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verificationtokens")
}

model Review {
  id               String   @id @default(cuid())
  productId        String
  customerName     String
  customerEmail    String?
  rating           Int
  title            String?
  comment          String
  images           String[] @default([])
  verifiedPurchase Boolean  @default(false)
  helpful          Int      @default(0)
  reported         Boolean  @default(false)
  approved         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  userId           String?
  product          Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user             User?    @relation(fields: [userId], references: [id])

  @@index([productId])
}

model ProductUnit {
  id            String    @id @default(cuid())
  productId     String
  serialNumber  String?   @unique
  imei          String?   @unique
  batchNo       String?
  status        String    @default("AVAILABLE")
  price         Float
  addedAt       DateTime  @default(now())
  soldAt        DateTime?
  saleId        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  product       Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  sale          Sale?     @relation(fields: [saleId], references: [id], onDelete: SetNull)

  @@map("product_units")
}

model Sale {
  id            String      @id @default(cuid())
  transactionNo String      @unique
  customerId    String?
  total         Float
  discount      Float       @default(0)
  discountType  String?
  tax           Float       @default(0)
  paymentMethod String?
  paymentStatus String      @default("PENDING")
  notes         String?
  createdBy     String
  completedAt   DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  createdByUser User        @relation("SalesCreatedBy", fields: [createdBy], references: [id])
  customer      User?       @relation("SalesCustomer", fields: [customerId], references: [id])
  items         SaleItem[]
  units         ProductUnit[]

  @@map("sales")
}

model SaleItem {
  id         String   @id @default(cuid())
  saleId     String
  productId  String
  quantity   Int
  unitPrice  Float
  total      Float
  notes      String?
  createdAt  DateTime @default(now())
  sale       Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Restrict)

  @@map("sale_items")
}

model InventoryLog {
  id            String   @id @default(cuid())
  productId     String
  previousStock Int
  newStock      Int
  change        Int
  reason        String
  createdAt     DateTime @default(now())
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([productId, createdAt])
  @@index([createdAt])
  @@map("inventory_logs")
}

model Customer {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  phone        String?
  addressLine1 String?
  addressLine2 String?
  city         String?
  state        String?
  postalCode   String?
  country      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  orders       Order[]
  notes        CustomerNote[]

  @@map("customers")
}

model CustomerNote {
  id         String   @id @default(cuid())
  customerId String
  content    String   @db.Text
  author     String
  createdAt  DateTime @default(now())
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@map("customer_notes")
}

model Order {
  id                String        @id @default(cuid())
  orderNumber       String        @unique
  customerId        String?
  subtotal          Float
  tax               Float         @default(0)
  shipping          Float         @default(0)
  total             Float
  status            OrderStatus   @default(PENDING)
  paymentMethod     String?
  paymentStatus     PaymentStatus @default(PENDING)
  transactionId     String?       @unique
  shippingAddress   String?
  estimatedDelivery DateTime?
  deliveredAt       DateTime?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  userId            String?
  orderItems        OrderItem[]
  customer          Customer?     @relation(fields: [customerId], references: [id])
  user              User?         @relation(fields: [userId], references: [id])

  @@index([customerId])
  @@index([userId])
  @@index([status])
  @@index([customerId, status])
  @@index([status, createdAt])
  @@map("orders")
}

model OrderItem {
  id             String          @id @default(cuid())
  orderId        String
  productId      String
  quantity       Int
  price          Float
  createdAt      DateTime        @default(now())
  variantDetails Json?
  variantId      String?
  order          Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product        Product         @relation(fields: [productId], references: [id])
  variant        ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([variantId])
  @@map("order_items")
}

model ContactInquiry {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String
  service   String?
  status    String   @default("NEW")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("contact_inquiries")
}

model StockAlert {
  id         String          @id @default(cuid())
  email      String
  productId  String?
  variantId  String?
  userId     String?
  notified   Boolean         @default(false)
  notifiedAt DateTime?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  product    Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  user       User?           @relation(fields: [userId], references: [id])
  variant    ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([productId])
  @@index([variantId])
  @@index([notified])
  @@map("stock_alerts")
}

model WishlistItem {
  id        String          @id @default(cuid())
  userId    String
  productId String
  variantId String?
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  product   Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  variant   ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([userId, productId, variantId])
  @@index([userId])
  @@index([productId])
  @@map("wishlist_items")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  COMPLETED
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  WAITING_CUSTOMER
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model SupportTicket {
  id          String         @id @default(cuid())
  ticketNumber String        @unique
  userId      String
  subject     String
  category    String
  priority    TicketPriority @default(MEDIUM)
  status      TicketStatus   @default(OPEN)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  resolvedAt  DateTime?
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages    TicketMessage[]

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@map("support_tickets")
}

model TicketMessage {
  id        String        @id @default(cuid())
  ticketId  String
  userId    String
  message   String        @db.Text
  isStaff   Boolean       @default(false)
  createdAt DateTime      @default(now())
  ticket    SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([userId])
  @@map("ticket_messages")
}

model Coupon {
  id                String              @id @default(cuid())
  code              String              @unique
  description       String?
  type              CouponType
  value             Float
  minPurchase       Float               @default(0)
  maxDiscount       Float?
  usageLimit        Int?
  usageCount        Int                 @default(0)
  validFrom         DateTime            @default(now())
  validUntil        DateTime
  isActive          Boolean             @default(true)
  campaigns         CampaignCoupon[]
  controlTests      ABTest[]            @relation("control")
  variantATests     ABTest[]            @relation("variantA")
  variantBTests     ABTest[]            @relation("variantB")
  variantCTests     ABTest[]            @relation("variantC")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([code])
  @@index([isActive])
  @@map("coupons")
}

enum CouponType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  ARCHIVED
}

enum TargetingType {
  ALL_CUSTOMERS
  SEGMENT
  PRODUCT_CATEGORY
  MINIMUM_PURCHASE
  CUSTOMER_TAG
}

model Campaign {
  id                  String              @id @default(cuid())
  name                String
  description         String?
  status              CampaignStatus      @default(DRAFT)
  targetingType       TargetingType       @default(ALL_CUSTOMERS)
  targetSegment       String?             // Category, tag, or segment name
  targetValue         Float?              // Min purchase amount
  coupons             CampaignCoupon[]
  emails              CampaignEmail[]
  abTests             ABTest[]
  calendarEvents      PromotionalCalendar[]
  startDate           DateTime
  endDate             DateTime
  budget              Float?              // Marketing budget in dollars
  spendToDate         Float               @default(0)
  expectedROI         Float?              // Expected Return on Investment %
  actualROI           Float?              // Actual ROI %
  impressions         Int                 @default(0)
  clicks              Int                 @default(0)
  conversions         Int                 @default(0)
  revenue             Float               @default(0)
  emailsSent          Int                 @default(0)
  emailsOpened        Int                 @default(0)
  emailsClicked       Int                 @default(0)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@map("campaigns")
}

model CampaignCoupon {
  id         String   @id @default(cuid())
  campaignId String
  couponId   String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  coupon     Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@unique([campaignId, couponId])
  @@index([campaignId])
  @@index([couponId])
  @@map("campaign_coupons")
}

enum EmailStatus {
  PENDING
  SENT
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

model CampaignEmail {
  id          String       @id @default(cuid())
  campaignId  String
  campaign    Campaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  email       String
  status      EmailStatus  @default(PENDING)
  sentAt      DateTime?
  openedAt    DateTime?
  clickedAt   DateTime?
  errorMessage String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([campaignId])
  @@index([email])
  @@index([status])
  @@map("campaign_emails")
}

model OrderSearchHistory {
  id        String   @id @default(cuid())
  userId    String
  query     String
  filters   Json?    @default("{}")
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("order_search_history")
}

enum ABTestStatus {
  DRAFT
  RUNNING
  PAUSED
  COMPLETED
  ARCHIVED
}

enum ABTestVariant {
  CONTROL
  VARIANT_A
  VARIANT_B
  VARIANT_C
}

model ABTest {
  id                  String              @id @default(cuid())
  campaignId          String
  campaign            Campaign            @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  name                String
  description         String?
  status              ABTestStatus        @default(DRAFT)
  testingMetric       String              // 'open_rate', 'click_rate', 'conversion_rate'
  hypothesis          String?
  
  // Control variant
  controlName         String              @default("Control")
  controlCouponId     String?
  controlCoupon       Coupon?             @relation(name: "control", fields: [controlCouponId], references: [id])
  
  // Variant A
  variantAName        String              @default("Variant A")
  variantACouponId    String?
  variantACoupon      Coupon?             @relation(name: "variantA", fields: [variantACouponId], references: [id])
  
  // Variant B
  variantBName        String              @default("Variant B")
  variantBCouponId    String?
  variantBCoupon      Coupon?             @relation(name: "variantB", fields: [variantBCouponId], references: [id])
  
  // Variant C
  variantCName        String              @default("Variant C")
  variantCCouponId    String?
  variantCCoupon      Coupon?             @relation(name: "variantC", fields: [variantCCouponId], references: [id])
  
  // Traffic allocation (percentages)
  controlTraffic      Int                 @default(25) // 25%
  variantATraffic     Int                 @default(25) // 25%
  variantBTraffic     Int                 @default(25) // 25%
  variantCTraffic     Int                 @default(25) // 25%
  
  // Dates
  startDate           DateTime
  endDate             DateTime
  winnerVariant       String?             // 'control', 'variantA', 'variantB', 'variantC'
  
  // Results
  controlOpens        Int                 @default(0)
  variantAOpens       Int                 @default(0)
  variantBOpens       Int                 @default(0)
  variantCOpens       Int                 @default(0)
  
  controlClicks       Int                 @default(0)
  variantAClicks      Int                 @default(0)
  variantBClicks      Int                 @default(0)
  variantCClicks      Int                 @default(0)
  
  controlConversions  Int                 @default(0)
  variantAConversions Int                 @default(0)
  variantBConversions Int                 @default(0)
  variantCConversions Int                 @default(0)
  
  // Confidence level for winner declaration
  confidenceLevel     Float               @default(0.95) // 95%
  
  // Relation to test emails
  emails              ABTestEmail[]
  
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([campaignId])
  @@index([status])
  @@index([startDate])
  @@map("ab_tests")
}

model ABTestEmail {
  id          String       @id @default(cuid())
  testId      String
  test        ABTest       @relation(fields: [testId], references: [id], onDelete: Cascade)
  email       String
  variant     ABTestVariant
  opened      Boolean      @default(false)
  clicked     Boolean      @default(false)
  converted   Boolean      @default(false)
  sentAt      DateTime?
  openedAt    DateTime?
  clickedAt   DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([testId])
  @@index([email])
  @@index([variant])
  @@map("ab_test_emails")
}

model PromotionalCalendar {
  id                  String              @id @default(cuid())
  campaignId          String
  campaign            Campaign            @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  date                DateTime
  eventType           String              // 'campaign_start', 'campaign_end', 'milestone', 'holiday', 'custom'
  eventName           String
  description         String?
  color               String              @default("blue") // For UI display
  reminderDays        Int                 @default(0) // Days before event to send reminder
  reminderSent        Boolean             @default(false)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([campaignId])
  @@index([date])
  @@index([eventType])
  @@map("promotional_calendar")
}

// Phase 7: Inventory Automation Models

model Supplier {
  id                    String              @id @default(cuid())
  name                  String
  email                 String
  phone                 String?
  address               String?
  leadTime              Int                 // Days to deliver
  minOrderQuantity      Int                 // Minimum order units
  costPerUnit           Float               // Wholesale cost
  maxOrderQuantity      Int?                // Max units per order
  preferredCategories   String[]            @default([])
  active                Boolean             @default(true)
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  productSuppliers      ProductSupplier[]
  reorders              ReorderTask[]

  @@index([active])
  @@index([name])
  @@map("suppliers")
}

model ProductSupplier {
  id                String              @id @default(cuid())
  productId         String
  supplierId        String
  supplierSku       String
  cost              Float               // Cost from this supplier
  leadTime          Int?                // Override supplier default
  preferred         Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  
  product           Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  supplier          Supplier            @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  
  @@unique([productId, supplierId])
  @@index([productId])
  @@index([supplierId])
  @@map("product_suppliers")
}

model SalesVelocity {
  id                String              @id @default(cuid())
  productId         String              @unique
  dailyVelocity     Float               @default(0)
  weeklyVelocity    Float               @default(0)
  monthlyVelocity   Float               @default(0)
  varianceDailyDemand Float             @default(0)
  lastUpdated       DateTime            @default(now())
  
  product           Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@map("sales_velocities")
}

model StockRecommendation {
  id                    String              @id @default(cuid())
  productId             String              @unique
  recommendedStock      Int
  minStock              Int
  maxStock              Int
  safetyStock           Int
  reorderPoint          Int
  forecastedVelocity    Float
  leadTimeVariance      Int?
  confidence            Float               @default(0.95)
  generatedAt           DateTime            @default(now())
  appliedAt             DateTime?
  updatedAt             DateTime            @updatedAt
  
  product               Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@index([appliedAt])
  @@map("stock_recommendations")
}

model ReorderTask {
  id                String              @id @default(cuid())
  productId         String
  supplierId        String?
  quantity          Int
  status            String              @default("PENDING") // "PENDING", "ORDERED", "RECEIVED", "CANCELLED"
  reorderPoint      Int
  reason            String              // "LOW_STOCK", "SCHEDULED", "MANUAL"
  orderedAt         DateTime?
  expectedAt        DateTime?
  receivedAt        DateTime?
  cost              Float?
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  
  product           Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  supplier          Supplier?           @relation(fields: [supplierId], references: [id])
  
  @@index([productId])
  @@index([status])
  @@index([createdAt])
  @@index([supplierId])
  @@map("reorder_tasks")
}

model DeadStockAlert {
  id                String              @id @default(cuid())
  productId         String              @unique
  daysWithoutSale   Int
  lastSaleDate      DateTime?
  currentStock      Int
  estimatedValue    Float
  status            String              @default("ACTIVE") // "ACTIVE", "REVIEWED", "ARCHIVED", "DELISTED"
  action            String?             // "DISCOUNT", "BUNDLE", "CLEARANCE", "RETURN", "DONATE"
  actionAt          DateTime?
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  
  product           Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([status])
  @@index([productId])
  @@index([createdAt])
  @@map("dead_stock_alerts")
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  targetType String?
  targetId   String?
  status     String   @default("SUCCESS")
  ip         String?
  userAgent  String?
  metadata   Json?
  createdAt  DateTime @default(now())

  user User? @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
  @@index([action])
  @@index([targetType, targetId])
  @@map("audit_logs")
}

model WebhookEndpoint {
  id             String    @id @default(cuid())
  url            String
  secret         String
  events         String[]
  isActive       Boolean   @default(true)
  description    String?
  headers        Json?
  lastDeliveryAt DateTime?
  lastStatus     String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([isActive])
  @@index([createdAt])
  @@map("webhook_endpoints")
}

model SavedFilter {
  id        String   @id @default(cuid())
  userId    String
  name      String
  resource  String
  query     Json
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, resource])
  @@map("saved_filters")
}

